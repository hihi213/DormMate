# 운영 환경 설정
# application.prod.properties 파일은 운영 환경에서 사용되는 환경 변수 설정 파일입니다.
# 실제 운영 배포에 사용되는 환경 변수 설정 파일입니다.
# 환경변수 이용 시 생성하는 .env 파일은 관리자에 따라 배포되지 않을 수 있음.   

# PostgreSQL Datasource (운영용 - 환경변수 사용)
spring.datasource.url=${DB_URL:jdbc:postgresql://localhost:5432/dormitory_db}
spring.datasource.username=${DB_USERNAME:dorm_user}
spring.datasource.password=${DB_PASSWORD:dorm_password}
spring.jpa.hibernate.ddl-auto=validate
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.format_sql=false
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.PostgreSQLDialect

# Redis (운영용 - 환경변수 사용)
spring.data.redis.host=${REDIS_HOST:localhost}
spring.data.redis.port=${REDIS_PORT:6379}
spring.data.redis.password=${REDIS_PASSWORD:}
spring.data.redis.timeout=5000ms

# Flyway Database Migration (운영용)
spring.flyway.enabled=true
spring.flyway.locations=classpath:db/migration
spring.flyway.baseline-on-migrate=true
spring.flyway.validate-on-migrate=true
spring.flyway.clean-disabled=true

# JWT Configuration (운영용 - 환경변수 사용)
jwt.secret=${JWT_SECRET:change-this-in-production}
jwt.expiration=${JWT_EXPIRATION:3600000}
jwt.refresh-expiration=${JWT_REFRESH_EXPIRATION:86400000}

# AWS S3 Configuration (운영용 - 환경변수 사용)
aws.s3.bucket=${AWS_S3_BUCKET:dormmate-prod-storage}
aws.s3.region=${AWS_S3_REGION:ap-northeast-2}
aws.s3.access-key=${AWS_ACCESS_KEY:}
aws.s3.secret-key=${AWS_SECRET_KEY:}

# Spring Security (운영용 - 환경변수 사용)
spring.security.user.name=${ADMIN_USERNAME:admin}
spring.security.user.password=${ADMIN_PASSWORD:}

# Actuator & Monitoring (운영용 - 제한된 엔드포인트만 노출)
management.endpoints.web.exposure.include=health,info,metrics,prometheus
management.endpoint.health.show-details=when-authorized
management.metrics.export.prometheus.enabled=true

# WebSocket
spring.websocket.max-text-message-size=4096
spring.websocket.max-binary-message-size=4096

# File Upload (운영용 - 제한된 크기)
spring.servlet.multipart.max-file-size=10MB
spring.servlet.multipart.max-request-size=10MB

# Logging (운영용 - 최소 로깅)
logging.level.com.dormmate=INFO
logging.level.org.springframework.security=WARN
logging.level.org.hibernate.SQL=WARN
logging.level.org.hibernate.type.descriptor.sql.BasicBinder=WARN
logging.level.org.flywaydb=INFO
logging.level.root=WARN

# Server
server.port=${SERVER_PORT:8080}
server.servlet.context-path=/

# Actuator (운영용 - 제한된 엔드포인트, 내부망 전용)
management.server.port=8081
management.server.address=127.0.0.1
management.endpoints.web.exposure.include=health,info
management.endpoint.health.show-details=never
management.info.git.mode=simple

# CORS 허용 오리진 (운영: 실제 도메인만 허용)
app.cors.allowed-origins=${CORS_ALLOWED_ORIGINS:https://example.com}

# 운영 환경 특화 설정
spring.jpa.defer-datasource-initialization=false
spring.sql.init.mode=never

# 성능 최적화
spring.jpa.properties.hibernate.jdbc.batch_size=20
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true
spring.jpa.properties.hibernate.jdbc.batch_versioned_data=true

# 보안 강화
server.tomcat.remote-ip-header=x-forwarded-for
server.tomcat.protocol-header=x-forwarded-proto
server.tomcat.port-header=x-forwarded-port
server.tomcat.use-relative-redirects=false


# (application.properties의 설정을 상속받아 사용)

# 헬스체크 상세 정보는 절대 노출하지 않거나(never), 인증된 경우에만(when_authorized) 표시
# 'when_authorized'가 더 안전한 옵션입니다.
management.endpoint.health.show-details=when_authorized