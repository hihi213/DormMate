# DormMate 냉장고 MVP 시연 시나리오
*용도: 이번 배포/데모에서 반드시 구현·시연할 전체 사용자 흐름과 전체 정책을 정의한 기준 문서로, 작업 전 현재 MVP 범위를 확인할 때 사용한다.*

## 1. 데모 목표
- DormMate 냉장고 모듈의 핵심 가치(라벨 자동 발급, 검사·알림 체계, 관리자 통제)를 10분 내에 전달한다.
- 실제 배포 환경에서 동작 중인 애플리케이션을 기반으로 “거주자 → 층별장 → 관리자” 흐름을 연속 시연한다.
- 층별장 검사 흐름은 단독 진행을 중심으로 안정성과 완성도를 강조한다. 실시간 합류(SSE)는 후속 확장 과제로 소개하거나 시간이 허용될 때 참고 시연한다.

## 2. 사전 준비
- **배포 환경**: 발표용 서버에 최신 이미지 배포, `docker-compose.prod.yml` 기준으로 백엔드·프런트·PostgreSQL·Redis 기동.
- **데모 데이터**: 
  - 3층 거주자 계정(예: `313-1`)에 포장 2건, 임박 물품 1건, 만료 물품 1건 사전 등록.
  - 층별장 계정은 `FLOOR_MANAGER` 역할 부여, 관리자 계정은 `ADMIN` 역할 확인.
  - 층별 냉장고 칸 배정표(냉장 1~3번: 01~08호/09~16호/17~24호, 냉동 1칸 전체 공용)를 준비해 시연 중 참조한다. 증설 시 재배분 예시(6칸 → 4개 호실 단위)도 설명 자료에 포함한다. 근거: [Feature Inventory §1 운영 환경 요약](feature-inventory.md#운영-환경-요약), [Feature Inventory §2 냉장고 증설·재배분](feature-inventory.md#냉장고-증설재배분).
  - 시연 직전 관리자는 `/admin/seed/fridge-demo` POST API를 호출해 전시 일정(11/12~11/20) 기준 물품 7건을 추가한다. 기존 사용자·포장은 유지되지만, `전시 데모:` 접두사가 붙은 물품은 모두 새로 교체되므로 운영 DB에서는 **절대 실행하지 말 것**을 명시하고 진행 여부를 재확인한다. (근거: `backend/src/main/resources/db/demo/fridge_exhibition_items.sql`, [운영 매뉴얼 “데모 데이터 초기화”](ops/README.md#데모-데이터-초기화-관리자-전용))
- **시연 장비**: 노트북 1대(HDMI 연결), 브라우저 2개 탭 준비(거주자/관리자). 층별장 화면은 시연 중 동일 브라우저의 시크릿 창 사용.
- **인증 점검**: 관리자 계정(`admin/password`)으로 백엔드 로그인 성공 여부를 확인하고, 세션 만료 시 로그인 화면으로 자동 안내되는지 사전에 검증한다.
- **비상 플랜**: 네트워크 또는 서버 장애 시 로컬 Docker Compose 환경으로 즉시 전환할 수 있도록 이미지 사전 빌드.

## 3. 시연 흐름

### 3.1 거주자 포장 등록 및 관리
*관련 문서: [Feature Inventory §2 냉장고 – 일반 기숙사생](feature-inventory.md#2-냉장고--일반-기숙사생), [MVP Plan FR-201](mvp-plan.md#fr-201-슬롯-접근-제어) · [FR-202](mvp-plan.md#fr-202-포장-등록-플로우) · [FR-203](mvp-plan.md#fr-203-임박만료--라벨-재사용)*
1. 거주자 계정 로그인 → `내 냉장고` 진입. (보안을 보여 주기 위해 다른 브라우저에서 동일 계정으로 로그인 시도 후 `deviceId` 불일치로 세션이 폐기되는지, 만료된 세션이 로그인 화면에서 안내 문구와 함께 재로그인을 요구하는지 간단히 확인)
2. `view=full` 옵션으로 슬롯 목록을 열어 용량·현재 점유 수(`occupiedCount`)를 확인한 뒤, 배정된 칸(A/B/C 중 하나) 선택 → 물품 이름·수량·유통기한 입력 → `등록` 클릭.
3. `max_bundle_count` 검증 통과 후 자동 발급된 라벨(`A123`)과 완료 토스트 확인, `001~999` 기본 범위와 관리자 조정 정책을 언급.
4. 목록 상단에 신규 포장이 생성된 것을 보여 주고, 검색창에 포장명 입력해 즉시 필터링.
5. 포장 목록이 페이지네이션(`page`,`size`)으로 노출됨을 보여 주고, 다음 페이지로 이동해 추가 데이터를 확인한다.
6. 임박/만료 배지 색상(노란색, 빨간색)을 예시 포장으로 강조하고, 물품 수정을 통해 배지 상태가 정책대로 업데이트되는 것을 확인.
7. 포장 메모는 작성자만 볼 수 있다는 안내와 함께, 물품 하나를 소프트 삭제해 동일 스티커 번호가 재사용되는 흐름을 시연.
8. 냉장고 증설/재배분 정책을 간단히 소개하고(예: 슬랏 4개 → 6개 전환 시 호실 4개씩 재배분), 관리자 화면에서 실제 재배분 결과를 확인할 계획임을 예고한다.
9. 다른 거주자 계정(예: `313-2`)으로 동일 칸에 추가 포장을 등록한 뒤, 최초 거주자 화면으로 돌아와 잔여 용량/점유 수가 즉시 반영되는지 확인한다. `occupiedCount` 기반으로 남은 용량이 줄어드는 모습을 강조해 다중 사용자 환경에서도 정합성이 유지됨을 보여 준다.
10. 검사 이후 수정된 포장에는 `updatedAfterInspection` 검사중에 필터로 선별보여줌

### 3.2 층별장 검사 세션 (단독 흐름)
*관련 문서: [Feature Inventory §4 냉장고 – 층별장(검사자)](feature-inventory.md#4-냉장고--층별장검사자), [MVP Plan IN-301](mvp-plan.md#in-301-검사-시작잠금) · [IN-302](mvp-plan.md#in-302-조치-선택벌점-연동) · [IN-303](mvp-plan.md#in-303-제출-요약잠금-해제) · [IN-304](mvp-plan.md#in-304-거주자-검사-열람-뷰) · [IN-305](mvp-plan.md#in-305-검사-벌점-도메인-연동)*
1. 층별장 계정 로그인 → `검사 관리` → 대상 칸 선택 → `검사 시작` 클릭.
2. 칸이 잠금 상태(`검사 중` 배지)로 전환되는 UI를 보여 주고, 거주자 화면에서 수정 버튼이 비활성화됐음을 확인.
3. 검사 화면에서 문제 없는 포장은 `통과`, 임박 포장은 `경고`, 만료 포장은 `폐기`로 조치 선택한다. 조치 시 자동으로 로컬 Draft가 저장되고, 수동 저장 버튼으로도 상태를 즉시 보관할 수 있음을 보여 준 뒤 재접속해 동일 상태가 복원되는지 확인한다.
4. 미등록 물품 발견 시 `간편 등록 → 즉시 폐기` 플로우 실행, 메모 입력 후 저장.
5. `검사 제출` 시 통계 요약(경고/폐기/총 포장 수) 확인, 칸 잠금 해제. 제출과 동시에 임시 저장 데이터가 정리됨을 안내한다.
6. 제출 직후 `조치 내역` 패널을 열어 폐기 사유·경고 메모·미등록 폐기 기록이 남겨진 것을 확인한다. `inspection_action_item`에 저장된 스냅샷 정보를 강조하고, 동일 데이터가 거주자 알림·벌점 처리와 연결될 것임을 짚는다.
7. 확장 계획으로 [MVP Plan IN-306](mvp-plan.md#in-306-실시간-검사-합류복구)에 따라 단일 SSE 스트림으로 2인 합류를 지원할 예정임을 언급하되, 현재 데모는 단독 검사 안정화에 초점을 둔다.

> *확장 아이디어*: 차기 일정에서 [MVP Plan IN-306](mvp-plan.md#in-306-실시간-검사-합류복구) 항목을 참고해 2인 합류·SSE 재연결 흐름을 구현/시연한다. (MVP 직후 우선 적용 예정)

### 3.3 검사 후 사용자 알림
*관련 문서: [Feature Inventory §3 냉장고 – 알림 & 일정](feature-inventory.md#3-냉장고--알림--일정), [MVP Plan NO-401](mvp-plan.md#no-401-검사-결과-알림-발행) · [NO-402](mvp-plan.md#no-402-검사-결과-알림-ui) · [NO-403](mvp-plan.md#no-403-알림-설정-ui)*
1. 거주자 탭으로 전환 → `[냉장고] 점검 결과 알림` 도착 확인. 새 알림이 상단 배지와 리스트 최상단에 노출됨을 보여 준다.
2. 알림을 클릭하면 `correlationId`로 연결된 검사 결과 상세 화면으로 이동한다. 방금 폐기된 포장이 강조되며, 경고/폐기 건수가 알림 본문과 일치하는지 확인한다.
3. 상세 화면에서 폐기 사유·경고 메모를 열람하고, 벌점 1점이 자동으로 누적된 사례를 `penalty_history` 모달(또는 관리자 화면 캡처)로 함께 보여 준다. `inspection_action_item`의 스냅샷 정보가 거주자에게도 체크 리스트 형태로 전달됨을 강조한다.
4. `알림 설정` 화면에서 냉장고 알림을 종류별로 ON/OFF 하고 백그라운드 수신 옵션을 토글한다. 변경 직후 `updated_at`이 갱신되고, 같은 계정의 다른 브라우저에서도 즉시 최신 설정이 반영되는지 확인한다.
5. 관리자 화면으로 전환해 `notification_dispatch_log`에서 방금 알림의 발송 결과·실패 코드가 기록됐는지 점검하고, 실패 시 재시도/원인 분석이 가능한 구조임을 설명한다.
6. 포장 목록으로 돌아가 검사 이후 수정된 물품에 배지가 표시되는지 확인하고, 벌점 내역(`penalty_history`) 모달·조치 스냅샷(`inspection_action_item`)이 알림의 `correlationId`와 연결돼 있음을 강조한다.

### 3.4 임박/만료 자동 알림
*관련 문서: [Feature Inventory §3 냉장고 – 알림 & 일정](feature-inventory.md#3-냉장고--알림--일정), [MVP Plan NO-501](mvp-plan.md#no-501-배치-알림-생성) · [NO-502](mvp-plan.md#no-502-임박만료-알림-ui)*
1. 알림 목록에서 매일 09:00 배치로 생성된 임박/만료 알림 더미 데이터를 확인.
2. 알림을 읽으면 임박 배지는 사라지고, 만료 알림은 해결 전까지 유지됨을 보여 준다.
3. 배치 스케줄은 Spring Scheduling으로 동작하며, Redis dedupe 키·24시간 TTL·발송 실패 로그가 정책대로 동작한다는 점을 슬라이드로 간단히 소개한다.

### 3.4.1 층별장 검사 일정 생성 (MVP)
*관련 문서: [Feature Inventory §4 냉장고 – 층별장(검사자)](feature-inventory.md#4-냉장고--층별장검사자), [MVP Plan SC-401](mvp-plan.md#sc-401-검사-일정이력-서버-관리)*
1. 층별장 화면에서 `일정추가` 버튼을 눌러 본인이 관리하는 칸내에서 다중 선택/단일 선택 모두 허용하고 날짜와 메모를 입력한다, 층 범위를 벗어나면 서버에서 거부된다.
2. 날짜/시간, 메모를 입력하고 저장하면 `inspection_schedule`에 일정이 생성된다
3. 일정 상세에서 수정/취소가 가능하며, 변경 시에도 동일한 거주자 알림과 감사 로그가 기록된다.
4. 나중에 `검사 시작` 시 팝업에서 생성해 둔 일정을 선택해 세션과 연결하고, 제출하면 일정이 자동으로 `COMPLETED` 처리된다.

### 3.4.2 Post-MVP: 관리자 일정 등록 + 층별장 알림
1. 관리자가 `/admin` 냉장고 탭에서 여러 층에 대한 검사 일정을 만들 수 있도록 UI와 API를 확장한다.
2. 관리자가 일정을 생성/수정하면 대상 칸의 층별장에게 알림이 발송되고, 층별장은 자신의 일정 목록에서 승인을 확인하거나 재조정한다.
3. 관리자 일정과 층별장 일정 간 중복 예약 방지, 승인 흐름, 공지용 알림 채널 연동을 설계해 차기 과제로 추진한다.

### 3.5 관리자 운영 통제
*관련 문서: [Feature Inventory §5 냉장고 – 관리자](feature-inventory.md#5-냉장고--관리자), [MVP Plan AD-601](mvp-plan.md#ad-601-칸-설정통계) · [AD-602](mvp-plan.md#ad-602-역할-관리) · [RG-701](mvp-plan.md#rg-701-회귀-테스트) · [RG-702](mvp-plan.md#rg-702-산출물-정리)*
1. 관리자 계정 로그인 → `냉장고 현황` 대시보드에서 층별 포장/임박 통계를 확인하고, “준비 중” 영역이 실제 데이터 위젯으로 교체됐음을 보여 준다.
2. 특정 칸의 `max_bundle_count`를 3 → 5로 조정하고 저장, 거주자 화면에서 여유 용량이 늘어난 것을 확인.
3. 냉장고 증설·재배분 정책(예: 칸 4→6개)을 요약하고, `compartment_room_access` 재계산 결과가 관리자 화면/시연 자료와 일치함을 설명한다. *참고: [Feature Inventory §2 냉장고 증설·재배분](feature-inventory.md#냉장고-증설재배분).*
4. 이전에 검사 중인 칸이 없음을 확인한 뒤, 다른 층별장에게 역할 부여/해제를 시연하고 권한 변경이 즉시 반영됨을 확인한다.
5. 벌점/알림 정책 관리 패널에서 실패 로그와 발송 상한을 조회·수정할 수 있음을 보여 주고, 문제가 있는 칸을 `SUSPENDED`로 전환했을 때 거주자 화면에서 접근이 차단되는 메시지를 확인한다.
6. `/fridge/inspections` 목록 화면에서 `slotId`·`status`·`limit` 필터를 조합해 최근 검사 이력을 빠르게 찾는 모습을 보여 주고, 관리자/층별장이 필요한 정보만 추려볼 수 있음을 강조한다.

## 4. 마무리 및 배포 안정성 강조
- Day6 스테이징 배포 → Smoke 테스트 → 데모 데이터 시딩 → Day7 프로덕션 배포까지 완료했다는 로그/지표를 마지막 슬라이드로 제시.
- 헬스체크(`/actuator/health`), 주요 API 응답 시간, 오류 로그 미발생을 확인했다는 근거 캡처를 공유.
- 실패 시 롤백 절차(이전 버전 이미지 재배포, Flyway `undo` 시나리오)를 문서화했음을 언급.
- RG-701~704 회귀·산출물 체크리스트(스모크, 검사/알림 회귀, 프런트 E2E)가 모두 마무리됐음을 한 줄로 요약해 엔지니어링 신뢰도를 강조.
- “실제 운영 가능한 DormMate 냉장고 MVP”라는 메시지로 시연을 마무리하고, 향후 확장(실시간 SSE, 다중 검사자 동기화, 알림 정책 UI 고도화)을 예고한다.

## 5. 발표 Q&A 대비 포인트
- **왜 SSE를 후순위로 뒀는가?** 단독 검사 플로우만으로도 정책 준수와 데이터 정합성이 보장되며, 실시간 협업은 로그/보안/성능 고려가 필요해 차기 과제로 남겼음을 설명.
- **알림 과다 문제 대응은?** dedupe 키, TTL, 사용자별 알림 설정으로 피로도를 관리하고, 공지성 메시지는 Band 앱으로 분리한다는 점을 강조.
- **배포 안정성?** Docker Compose 기반 무중단 롤아웃과 Flyway 마이그레이션 검증, 모니터링/로그 체계를 보여 주어 신뢰 확보.


## 시간남으면 할것(배포후 할것)
- 그래도 시간이 남으면 임시저장 서버에 draft로 저장 
