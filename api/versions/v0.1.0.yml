openapi: 3.0.3
info:
  title: DormMate API (MVP)
  version: 0.1.1
  description: |
    DormMate MVP contract-first specification. 모든 코드는 이 명세와 동기화되어야 하며,
    CI에서는 런타임 OpenAPI와 본 파일을 비교해 드리프트를 감지한다.
servers:
  - url: http://localhost:8080
    description: 로컬 개발 기본 URL
tags:
  - name: Auth
    description: 로그인, 토큰 재발급, 로그아웃
  - name: Profile
    description: 현재 사용자 역할/권한 조회
  - name: Fridge
    description: 거주자 냉장고 포장/물품 기능
  - name: Inspections
    description: 층별장 검사 세션 및 결과 기록
  - name: Events
    description: 폴링 기반 실시간 이벤트 전파
  - name: FridgeAdmin
    description: 관리자 냉장고 자원 제어
components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  responses:
    BadRequest:
      description: 잘못된 요청
      content:
        application/problem+json:
          schema: { $ref: '#/components/schemas/Problem' }
    Unauthorized:
      description: 인증 실패
      content:
        application/problem+json:
          schema: { $ref: '#/components/schemas/Problem' }
    Forbidden:
      description: 권한 부족
      content:
        application/problem+json:
          schema: { $ref: '#/components/schemas/Problem' }
    NotFound:
      description: 리소스를 찾을 수 없음
      content:
        application/problem+json:
          schema: { $ref: '#/components/schemas/Problem' }
    Conflict:
      description: 처리 충돌
      content:
        application/problem+json:
          schema: { $ref: '#/components/schemas/Problem' }
    UnprocessableEntity:
      description: 비즈니스 규칙 위반
      content:
        application/problem+json:
          schema: { $ref: '#/components/schemas/Problem' }
    TooManyRequests:
      description: 요청 한도 초과
      content:
        application/problem+json:
          schema: { $ref: '#/components/schemas/Problem' }
  schemas:
    Problem:
      type: object
      properties:
        type: { type: string }
        title: { type: string }
        status: { type: integer }
        detail: { type: string }
        instance: { type: string }
    RoleCode:
      type: string
      enum: [RESIDENT, FLOOR_MANAGER, ADMIN]
    TokenPair:
      type: object
      properties:
        accessToken:
          type: string
          description: 서명된 JWT 액세스 토큰
        tokenType:
          type: string
          enum: [Bearer]
          default: Bearer
        expiresIn:
          type: integer
          format: int64
          description: 액세스 토큰 만료까지 남은 초
        refreshToken:
          type: string
        refreshExpiresIn:
          type: integer
          format: int64
          description: 리프레시 토큰 만료까지 남은 초
        issuedAt:
          type: string
          format: date-time
      required: [accessToken, tokenType, expiresIn, refreshToken, refreshExpiresIn, issuedAt]
    LoginRequest:
      type: object
      properties:
        loginId: { type: string }
        password: { type: string, format: password }
        deviceId:
          type: string
          nullable: false
          description: 다중 디바이스 토큰 관리용 식별자
      required: [loginId, password, deviceId]
    LoginResponse:
      type: object
      properties:
        tokens: { $ref: '#/components/schemas/TokenPair' }
        user: { $ref: '#/components/schemas/UserProfile' }
      required: [tokens, user]
    RefreshRequest:
      type: object
      properties:
        refreshToken: { type: string }
        deviceId:
          type: string
          nullable: false
      required: [refreshToken, deviceId]
    LogoutRequest:
      type: object
      properties:
        refreshToken: { type: string }
      required: [refreshToken]
    RoomAssignment:
      type: object
      properties:
        roomId: { type: string, format: uuid }
        floor: { type: integer }
        roomNumber: { type: string }
        personalNo: { type: integer }
        assignedAt: { type: string, format: date-time }
      required: [roomId, floor, roomNumber, personalNo, assignedAt]
    UserProfile:
      type: object
      properties:
        userId: { type: string, format: uuid }
        loginId: { type: string }
        displayName: { type: string }
        email:
          type: string
          format: email
          nullable: true
        roles:
          type: array
          items: { $ref: '#/components/schemas/RoleCode' }
        primaryRoom:
          $ref: '#/components/schemas/RoomAssignment'
        isFloorManager: { type: boolean }
        isAdmin: { type: boolean }
        createdAt: { type: string, format: date-time }
        updatedAt: { type: string, format: date-time }
      required: [userId, loginId, displayName, roles, isFloorManager, isAdmin, createdAt, updatedAt]
    SlotType:
      type: string
      enum: [CHILL, FREEZE]
    ResourceStatus:
      type: string
      enum: [ACTIVE, SUSPENDED, REPORTED, RETIRED]
    FridgeSlot:
      type: object
      properties:
        slotId: { type: string, format: uuid }
        slotIndex: { type: integer }
        slotLetter: { type: string }
        floorNo: { type: integer }
        floorCode: { type: string }
        compartmentType: { $ref: '#/components/schemas/SlotType' }
        resourceStatus: { $ref: '#/components/schemas/ResourceStatus' }
        locked: { type: boolean }
        lockedUntil:
          type: string
          format: date-time
          nullable: true
        capacity:
          type: integer
          nullable: true
        displayName:
          type: string
          nullable: true
      required:
        [slotId, slotIndex, slotLetter, floorNo, floorCode, compartmentType, resourceStatus, locked]
    UpdateCompartmentConfigRequest:
      type: object
      properties:
        maxBundleCount:
          type: integer
          minimum: 1
        status:
          $ref: '#/components/schemas/ResourceStatus'
      additionalProperties: false
    ItemFreshness:
      type: string
      enum: [ok, expiring, expired]
    FridgeItem:
      type: object
      properties:
        itemId: { type: string, format: uuid }
        bundleId: { type: string, format: uuid }
        name: { type: string }
        expiryDate: { type: string, format: date }
        quantity:
          type: integer
          nullable: true
        unitCode:
          type: string
          nullable: true
        freshness:
          $ref: '#/components/schemas/ItemFreshness'
        lastInspectedAt:
          type: string
          format: date-time
          nullable: true
        updatedAfterInspection: { type: boolean }
        createdAt: { type: string, format: date-time }
        updatedAt: { type: string, format: date-time }
        removedAt:
          type: string
          format: date-time
          nullable: true
        items:
          type: array
          items: { $ref: '#/components/schemas/FridgeItem' }
          nullable: true
      required:
        [itemId, bundleId, name, expiryDate, freshness, updatedAfterInspection, createdAt, updatedAt]
    BundleStatus:
      type: string
      enum: [ACTIVE, DELETED]
    FridgeBundleSummary:
      type: object
      properties:
        bundleId: { type: string, format: uuid }
        slotId: { type: string, format: uuid }
        slotIndex: { type: integer }
        slotLabel: { type: string }
        labelNumber: { type: integer }
        labelDisplay: { type: string }
        bundleName: { type: string }
        memo:
          type: string
          nullable: true
        ownerUserId: { type: string, format: uuid }
        ownerDisplayName:
          type: string
          nullable: true
        ownerRoomNumber:
          type: string
          nullable: true
        status: { $ref: '#/components/schemas/BundleStatus' }
        freshness:
          type: string
          enum: [ok, expiring, expired]
        itemCount: { type: integer }
        createdAt: { type: string, format: date-time }
        updatedAt: { type: string, format: date-time }
        removedAt:
          type: string
          format: date-time
          nullable: true
      required:
        [bundleId, slotId, slotIndex, slotLabel, labelNumber, labelDisplay, bundleName, status, freshness, itemCount, createdAt, updatedAt]
    FridgeBundle:
      allOf:
        - $ref: '#/components/schemas/FridgeBundleSummary'
        - type: object
          properties:
            items:
              type: array
              items: { $ref: '#/components/schemas/FridgeItem' }
          required: [items]
    BundleListResponse:
      type: object
      properties:
        items:
          type: array
          items: { $ref: '#/components/schemas/FridgeBundleSummary' }
        totalCount: { type: integer, format: int64 }
      required: [items, totalCount]
    CreateBundleItemInput:
      type: object
      properties:
        name: { type: string }
        expiryDate: { type: string, format: date }
        quantity:
          type: integer
          nullable: true
        unitCode:
          type: string
          nullable: true
      required: [name, expiryDate]
    CreateBundleRequest:
      type: object
      properties:
        slotId: { type: string, format: uuid }
        bundleName: { type: string }
        memo:
          type: string
          nullable: true
        items:
          type: array
          items: { $ref: '#/components/schemas/CreateBundleItemInput' }
      required: [slotId, bundleName, items]
    CreateBundleResponse:
      type: object
      properties:
        bundle: { $ref: '#/components/schemas/FridgeBundle' }
      required: [bundle]
    UpdateBundleRequest:
      type: object
      properties:
        bundleName:
          type: string
          nullable: true
        memo:
          type: string
          nullable: true
        removedAt:
          type: string
          format: date-time
          nullable: true
    AddItemRequest:
      type: object
      properties:
        name: { type: string }
        expiryDate: { type: string, format: date }
        quantity:
          type: integer
          nullable: true
        unitCode:
          type: string
          nullable: true
      required: [name, expiryDate]
    UpdateItemRequest:
      type: object
      properties:
        name:
          type: string
          nullable: true
        expiryDate:
          type: string
          format: date
          nullable: true
        quantity:
          type: integer
          nullable: true
        unitCode:
          type: string
          nullable: true
        removedAt:
          type: string
          format: date-time
          nullable: true
    InspectionStatus:
      type: string
      enum: [IN_PROGRESS, SUBMITTED, CANCELED]
    InspectionAction:
      type: string
      enum: [WARN_INFO_MISMATCH, WARN_STORAGE_POOR, DISPOSE_EXPIRED, PASS, UNREGISTERED_DISPOSE]
    InspectionActionSummary:
      type: object
      properties:
        action: { $ref: '#/components/schemas/InspectionAction' }
        count: { type: integer }
      required: [action, count]
    InspectionSession:
      type: object
      properties:
        sessionId: { type: string, format: uuid }
        slotId: { type: string, format: uuid }
        slotIndex: { type: integer }
        slotLabel: { type: string }
        floorNo: { type: integer }
        floorCode:
          type: string
          nullable: true
        status: { $ref: '#/components/schemas/InspectionStatus' }
        startedBy: { type: string, format: uuid }
        startedAt: { type: string, format: date-time }
        endedAt:
          type: string
          format: date-time
          nullable: true
        bundles:
          type: array
          items: { $ref: '#/components/schemas/FridgeBundle' }
        summary:
          type: array
          items: { $ref: '#/components/schemas/InspectionActionSummary' }
        notes:
          type: string
          nullable: true
      required: [sessionId, slotId, slotIndex, slotLabel, floorNo, status, startedBy, startedAt, bundles, summary]
    InspectionActionEntry:
      type: object
      properties:
        bundleId:
          type: string
          format: uuid
          nullable: true
        itemId:
          type: string
          format: uuid
          nullable: true
        action: { $ref: '#/components/schemas/InspectionAction' }
        note:
          type: string
          nullable: true
      required: [action]
    InspectionActionRequest:
      type: object
      properties:
        actions:
          type: array
          minItems: 1
          items: { $ref: '#/components/schemas/InspectionActionEntry' }
      required: [actions]
    SubmitInspectionRequest:
      type: object
      properties:
        notes:
          type: string
          nullable: true
    PollEvent:
      type: object
      properties:
        eventId: { type: integer, format: int64 }
        type: { type: string }
        resourceId:
          type: integer
          format: int64
          nullable: true
        floorCode:
          type: string
          nullable: true
        data: { type: string }
        correlationId:
          type: string
          nullable: true
        createdAt:
          type: string
          format: date-time
          nullable: true
      required: [eventId, type, data]
    PollResponse:
      type: object
      properties:
        lastId: { type: integer, format: int64 }
        events:
          type: array
          items: { $ref: '#/components/schemas/PollEvent' }
      required: [lastId, events]
paths:
  /auth/login:
    post:
      tags: [Auth]
      summary: DormMate 로그인
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/LoginRequest' }
      responses:
        '200':
          description: 로그인 성공
          content:
            application/json:
              schema: { $ref: '#/components/schemas/LoginResponse' }
        '400': { $ref: '#/components/responses/BadRequest' }
        '401': { $ref: '#/components/responses/Unauthorized' }
        '429': { $ref: '#/components/responses/TooManyRequests' }
  /auth/refresh:
    post:
      tags: [Auth]
      summary: 리프레시 토큰으로 세션 갱신
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/RefreshRequest' }
      responses:
        '200':
          description: 갱신 성공
          content:
            application/json:
              schema: { $ref: '#/components/schemas/LoginResponse' }
        '400': { $ref: '#/components/responses/BadRequest' }
        '401': { $ref: '#/components/responses/Unauthorized' }
        '429': { $ref: '#/components/responses/TooManyRequests' }
  /auth/logout:
    post:
      tags: [Auth]
      summary: 리프레시 토큰 폐기
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/LogoutRequest' }
      responses:
        '204':
          description: 로그아웃 완료
        '400': { $ref: '#/components/responses/BadRequest' }
        '401': { $ref: '#/components/responses/Unauthorized' }
  /profile/me:
    get:
      tags: [Profile]
      summary: 현재 로그인 사용자 정보
      security: [{ BearerAuth: [] }]
      responses:
        '200':
          description: 사용자 프로필
          content:
            application/json:
              schema: { $ref: '#/components/schemas/UserProfile' }
        '401': { $ref: '#/components/responses/Unauthorized' }
  /fridge/slots:
    get:
      tags: [Fridge]

  /admin/fridge/compartments/{compartmentId}:
    patch:
      tags: [FridgeAdmin]
      summary: 냉장고 칸 설정 수정
      operationId: updateFridgeCompartment
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: compartmentId
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateCompartmentConfigRequest'
      responses:
        '200':
          description: 수정 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FridgeSlot'
        '403':
          description: 관리자 권한 필요
        '404':
          description: 대상 칸을 찾을 수 없음
        '409':
          description: 검사 세션이 진행 중인 칸은 상태를 변경할 수 없음
        '422':
          description: 현재 활성 포장 수보다 낮게 용량을 설정할 수 없음
      summary: 냉장고 칸 메타데이터 조회
      security: [{ BearerAuth: [] }]
      parameters:
        - in: query
          name: floor
          schema: { type: integer, minimum: 2, maximum: 5 }
          description: 조회할 층 (기본 2층)
        - in: query
          name: view
          schema:
            type: string
            enum: [basic, full]
          description: full 시 displayName, label 범위, 용량 정보 포함
      responses:
        '200':
          description: 칸 목록
          content:
            application/json:
              schema:
                type: array
                items: { $ref: '#/components/schemas/FridgeSlot' }
        '401': { $ref: '#/components/responses/Unauthorized' }
        '403': { $ref: '#/components/responses/Forbidden' }
  /fridge/bundles:
    get:
      tags: [Fridge]
      summary: 포장 목록 조회
      security: [{ BearerAuth: [] }]
      parameters:
        - in: query
          name: slotId
          schema: { type: string, format: uuid }
          description: 특정 칸(슬롯)만 필터링
        - in: query
          name: owner
          schema:
            type: string
            enum: [me, all]
          description: me 지정 시 내 포장만 반환
        - in: query
          name: status
          schema:
            type: string
            enum: [active, deleted]
          description: deleted 지정 시 소프트 삭제 포함
        - in: query
          name: search
          schema: { type: string }
          description: 포장명/물품명/라벨(A123) 검색
        - in: query
          name: page
          schema: { type: integer, minimum: 0, default: 0 }
        - in: query
          name: size
          schema: { type: integer, minimum: 1, maximum: 100, default: 20 }
      responses:
        '200':
          description: 포장 목록
          content:
            application/json:
              schema: { $ref: '#/components/schemas/BundleListResponse' }
        '401': { $ref: '#/components/responses/Unauthorized' }
        '403': { $ref: '#/components/responses/Forbidden' }
    post:
      tags: [Fridge]
      summary: 새 포장 생성
      security: [{ BearerAuth: [] }]
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/CreateBundleRequest' }
      responses:
        '201':
          description: 생성 완료
          content:
            application/json:
              schema: { $ref: '#/components/schemas/CreateBundleResponse' }
        '400': { $ref: '#/components/responses/BadRequest' }
        '401': { $ref: '#/components/responses/Unauthorized' }
        '403': { $ref: '#/components/responses/Forbidden' }
        '409': { $ref: '#/components/responses/Conflict' }
        '422': { $ref: '#/components/responses/UnprocessableEntity' }
  /fridge/bundles/{bundleId}:
    parameters:
      - in: path
        name: bundleId
        required: true
        schema: { type: string, format: uuid }
    get:
      tags: [Fridge]
      summary: 포장 상세 조회
      security: [{ BearerAuth: [] }]
      responses:
        '200':
          description: 포장 상세
          content:
            application/json:
              schema: { $ref: '#/components/schemas/FridgeBundle' }
        '401': { $ref: '#/components/responses/Unauthorized' }
        '403': { $ref: '#/components/responses/Forbidden' }
        '404': { $ref: '#/components/responses/NotFound' }
    patch:
      tags: [Fridge]
      summary: 포장 정보 수정
      security: [{ BearerAuth: [] }]
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/UpdateBundleRequest' }
      responses:
        '200':
          description: 수정된 포장
          content:
            application/json:
              schema: { $ref: '#/components/schemas/FridgeBundle' }
        '400': { $ref: '#/components/responses/BadRequest' }
        '401': { $ref: '#/components/responses/Unauthorized' }
        '403': { $ref: '#/components/responses/Forbidden' }
        '404': { $ref: '#/components/responses/NotFound' }
        '409': { $ref: '#/components/responses/Conflict' }
        '422': { $ref: '#/components/responses/UnprocessableEntity' }
    delete:
      tags: [Fridge]
      summary: 포장 삭제(소프트 삭제)
      security: [{ BearerAuth: [] }]
      responses:
        '204':
          description: 삭제 완료
        '401': { $ref: '#/components/responses/Unauthorized' }
        '403': { $ref: '#/components/responses/Forbidden' }
        '404': { $ref: '#/components/responses/NotFound' }
  /fridge/bundles/{bundleId}/items:
    parameters:
      - in: path
        name: bundleId
        required: true
        schema: { type: string, format: uuid }
    post:
      tags: [Fridge]
      summary: 포장에 물품 추가
      security: [{ BearerAuth: [] }]
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/AddItemRequest' }
      responses:
        '201':
          description: 추가된 물품
          content:
            application/json:
              schema: { $ref: '#/components/schemas/FridgeItem' }
        '400': { $ref: '#/components/responses/BadRequest' }
        '401': { $ref: '#/components/responses/Unauthorized' }
        '403': { $ref: '#/components/responses/Forbidden' }
        '404': { $ref: '#/components/responses/NotFound' }
        '409': { $ref: '#/components/responses/Conflict' }
        '422': { $ref: '#/components/responses/UnprocessableEntity' }
  /fridge/items/{itemId}:
    parameters:
      - in: path
        name: itemId
        required: true
        schema: { type: string, format: uuid }
    patch:
      tags: [Fridge]
      summary: 물품 수정
      security: [{ BearerAuth: [] }]
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/UpdateItemRequest' }
      responses:
        '200':
          description: 수정된 물품
          content:
            application/json:
              schema: { $ref: '#/components/schemas/FridgeItem' }
        '400': { $ref: '#/components/responses/BadRequest' }
        '401': { $ref: '#/components/responses/Unauthorized' }
        '403': { $ref: '#/components/responses/Forbidden' }
        '404': { $ref: '#/components/responses/NotFound' }
        '409': { $ref: '#/components/responses/Conflict' }
        '422': { $ref: '#/components/responses/UnprocessableEntity' }
    delete:
      tags: [Fridge]
      summary: 물품 삭제(소프트)
      security: [{ BearerAuth: [] }]
      responses:
        '204':
          description: 삭제 완료
        '401': { $ref: '#/components/responses/Unauthorized' }
        '403': { $ref: '#/components/responses/Forbidden' }
        '404': { $ref: '#/components/responses/NotFound' }
  /fridge/inspections:
    post:
      tags: [Inspections]
      summary: 검사 세션 시작
      security: [{ BearerAuth: [] }]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                slotId: { type: string, format: uuid }
              required: [slotId]
      responses:
        '201':
          description: 생성된 검사 세션
          content:
            application/json:
              schema: { $ref: '#/components/schemas/InspectionSession' }
        '400': { $ref: '#/components/responses/BadRequest' }
        '401': { $ref: '#/components/responses/Unauthorized' }
        '403': { $ref: '#/components/responses/Forbidden' }
        '409': { $ref: '#/components/responses/Conflict' }
  /fridge/inspections/active:
    get:
      tags: [Inspections]
      summary: 현재 검사 세션 조회
      security: [{ BearerAuth: [] }]
      parameters:
        - in: query
          name: floor
          schema: { type: integer, minimum: 2, maximum: 5 }
          description: 특정 층 기준으로 필터링
      responses:
        '200':
          description: 진행 중인 세션
          content:
            application/json:
              schema: { $ref: '#/components/schemas/InspectionSession' }
        '204':
          description: 진행 중인 세션 없음
        '401': { $ref: '#/components/responses/Unauthorized' }
        '403': { $ref: '#/components/responses/Forbidden' }
  /fridge/inspections/{sessionId}:
    parameters:
      - in: path
        name: sessionId
        required: true
        schema: { type: integer, format: int64 }
    get:
      tags: [Inspections]
      summary: 검사 세션 상세
      security: [{ BearerAuth: [] }]
      responses:
        '200':
          description: 검사 세션
          content:
            application/json:
              schema: { $ref: '#/components/schemas/InspectionSession' }
        '401': { $ref: '#/components/responses/Unauthorized' }
        '403': { $ref: '#/components/responses/Forbidden' }
        '404': { $ref: '#/components/responses/NotFound' }
    delete:
      tags: [Inspections]
      summary: 검사 세션 취소
      security: [{ BearerAuth: [] }]
      responses:
        '204':
          description: 취소 완료
        '401': { $ref: '#/components/responses/Unauthorized' }
        '403': { $ref: '#/components/responses/Forbidden' }
        '404': { $ref: '#/components/responses/NotFound' }
        '409': { $ref: '#/components/responses/Conflict' }
  /fridge/inspections/{sessionId}/actions:
    post:
      tags: [Inspections]
      summary: 검사 조치 기록
      security: [{ BearerAuth: [] }]
      parameters:
        - in: path
          name: sessionId
          required: true
          schema: { type: integer, format: int64 }
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/InspectionActionRequest' }
      responses:
        '200':
          description: 갱신된 세션
          content:
            application/json:
              schema: { $ref: '#/components/schemas/InspectionSession' }
        '400': { $ref: '#/components/responses/BadRequest' }
        '401': { $ref: '#/components/responses/Unauthorized' }
        '403': { $ref: '#/components/responses/Forbidden' }
        '404': { $ref: '#/components/responses/NotFound' }
        '409': { $ref: '#/components/responses/Conflict' }
        '422': { $ref: '#/components/responses/UnprocessableEntity' }
  /fridge/inspections/{sessionId}/submit:
    post:
      tags: [Inspections]
      summary: 검사 결과 제출
      security: [{ BearerAuth: [] }]
      parameters:
        - in: path
          name: sessionId
          required: true
          schema: { type: integer, format: int64 }
      requestBody:
        required: false
        content:
          application/json:
            schema: { $ref: '#/components/schemas/SubmitInspectionRequest' }
      responses:
        '200':
          description: 제출 완료된 세션
          content:
            application/json:
              schema: { $ref: '#/components/schemas/InspectionSession' }
        '400': { $ref: '#/components/responses/BadRequest' }
        '401': { $ref: '#/components/responses/Unauthorized' }
        '403': { $ref: '#/components/responses/Forbidden' }
        '404': { $ref: '#/components/responses/NotFound' }
        '409': { $ref: '#/components/responses/Conflict' }
        '422': { $ref: '#/components/responses/UnprocessableEntity' }
  /events/poll:
    get:
      tags: [Events]
      summary: 폴링 커서 조회
      description: sinceId 이후 이벤트를 event_id 오름차순으로 반환한다.
      security: [{ BearerAuth: [] }]
      parameters:
        - in: query
          name: sinceId
          schema: { type: integer, format: int64 }
          description: 마지막으로 수신한 eventId. 빈 값이면 최신 50개를 반환한다.
        - in: query
          name: limit
          schema: { type: integer, minimum: 1, maximum: 200, default: 50 }
          description: 한번에 받을 이벤트 수 상한
        - in: query
          name: resourceId
          schema: { type: integer, format: int64 }
          description: 특정 리소스(event_log.resource_id) 필터
        - in: query
          name: floor
          schema: { type: string }
          description: 층 코드 필터 (예: 2F)
      responses:
        '200':
          description: 이벤트 목록
          content:
            application/json:
              schema: { $ref: '#/components/schemas/PollResponse' }
        '401': { $ref: '#/components/responses/Unauthorized' }
        '403': { $ref: '#/components/responses/Forbidden' }
        '409': { $ref: '#/components/responses/Conflict' }
        '422': { $ref: '#/components/responses/UnprocessableEntity' }
        '423':
          description: 세션 잠금 상태
          content:
            application/problem+json:
              schema: { $ref: '#/components/schemas/Problem' }
        '429': { $ref: '#/components/responses/TooManyRequests' }
