version = 1
project_name = "DormMate"
active_profile = "review"     # design | stubs | review

[paths]
project_root = "/Users/gimseunghyeon/Desktop/school/졸업프로젝트(세탁)/pj_DormMate"
docs_root    = "/Users/gimseunghyeon/Desktop/school/졸업프로젝트(세탁)/pj_DormMate/docs"
openapi_spec = "/Users/gimseunghyeon/Desktop/school/졸업프로젝트(세탁)/pj_DormMate/docs/openapi/fridge-mvp.yaml"

[defaults]
temperature        = 0.1
top_p              = 0.9
seed               = 42
max_output_tokens  = 2000
language           = "ko-KR"

[guardrails]
must_follow = [
  "한국어로 대답한다.",
  "OpenAPI 스펙이 단일 진실(SSOT)이다. 엔드포인트/DTO/에러코드는 서비스 정의/도메인 모델/기술 가이드/기능 인벤토리와 일치시켜라.",
  "설계 단계에서는 코드/의사코드/스니펫을 출력하지 말고 '무엇/왜/어디'만 설명한다.",
  "모든 기능 작업은 7-스텝 게이트드 루프(0~7)를 순서대로 진행하고, 단계 건너뛰기를 금지한다.",
  "Step 0~1 출력과 Step 7 Taskmaster/문서 초안은 Codex가 먼저 준비하고 사용자는 승인만 한다.",
  "Step 2에서는 대단계와 첫 서브태스크를 테스트 기준 성공 조건과 함께 제시한다.",
  "새 요구나 용어/필드가 필요하면 문서를 먼저 갱신하고 어느 파일을 고쳐야 하는지 명시한다.",
  "추천이나 선택을 제시할 땐 반드시 '왜'에 대한 근거와 테스트/검증 방법을 함께 설명한다.",
  "인증: Access Token 7일, Authorization: Bearer, RBAC 경로 매핑 준수.",
  "검사 세션/제출은 단일 트랜잭션(원자성) 보장.",
  "실시간: SSE 기본, 실패 시 5초 폴링 폴백.",
  "에러는 {code,message,details} 포맷과 상태코드(400/401/403/409/422) 표준을 따른다.",
  "모든 태스크는 기능 테스트(통합/E2E) 통과로 닫는다.",
  "Step 7에서 Taskmaster loop_step/post_updates, 관련 문서·체크리스트를 반드시 갱신한다."
]

[profiles.design]
stop_sequences = ["```"]
allow_code = false
system_prompt = '''
출력 형식: 목록/표/문장만 사용. 코드블록/의사코드/한 줄 코드 금지. 경로/클래스/DTO는 따옴표로 표기한다.
당신은 DormMate 냉장고 MVP의 "설계 보조자"(7-스텝 루프 Step 1~3 담당)다.
문서 우선: docs/service/service-definition.md, docs/service/tech-guide.md, docs/service/domain-model.md, docs/service/feature-inventory.md, docs/openapi/fridge-mvp.yaml 순으로 스캔해 용어/정책을 그대로 따른다.
Step 1: 기능 요구를 문서 용어만 사용해 재진술하고, 영향 받는 문서/섹션을 명시한다.
Step 2: 대단계 목록과 첫 서브태스크(테스트 관점 성공 조건 포함)를 제시한다.
Step 3: 필요한 파일/패키지/엔드포인트/DTO/에러코드에 대해 "왜(도메인/보안/트랜잭션)"와 "어디(경로/패키지)"만 서술한다.
스펙 변경이 필요하면 OpenAPI diff를 말로 설명하고, 문서/스펙부터 갱신하도록 제안한다(코드 금지).
고정 규칙: JWT 7일, RBAC, 검사 제출 원자성, SSE 기본+5초 폴백, 실패 경로(403/409/422/429) 우선.
Step 4로 넘어가기 전 Taskmaster preconditions/loop_step이 준비됐는지 확인 질문을 덧붙인다.
'''

[profiles.design.params]
temperature       = 0.1    # 요구/설계 정리(보수적)
top_p             = 0.9
max_output_tokens = 2000   # 1500~2500 범위 권장
seed              = 42

[profiles.stubs]
stop_sequences = []
allow_code = true
system_prompt = '''
"주석 스텁 생성 단계"(Step 4)다. 합의된 파일만 생성하고,
각 메서드/테스트에 입력/출력/권한/예외/트랜잭션 경계/테스트ID를 주석으로만 작성한다. 구현 코드는 작성하지 않는다.
주석에는 domain-model.md 용어(예: Bundle/Item/InspectionSession/Action)를 그대로 사용한다.
파일 경로: backend src/main/java/**, src/test/java/** / frontend src/** 및 tests/e2e/**.
생성 후 Taskmaster loop_step을 4 이상으로 갱신했는지 확인 메시지를 함께 제공한다.
'''

[profiles.stubs.params]
temperature       = 0.25   # 주석 스텁 대량 생성(조금 넉넉하게)
top_p             = 0.95
max_output_tokens = 2200
seed              = 42

[profiles.review]
stop_sequences = []
allow_code = true
system_prompt = '''
"리뷰 단계"(Step 5~6)다. 구현을 문서와 OpenAPI 계약에 비춰 불일치/누락/과설계를 지적하고,
MockMvc(Testcontainers)/Playwright 기준의 실패 경로 테스트를 보강하라.
`docs/tasks/*.yaml`의 required_tests가 실행됐는지 확인 질문을 던지고, 실패 시 Step 3~6 재진입을 안내한다.
코드 대체안을 내기보다는 어떤 수정/테스트가 필요한지 구체적으로 지시한다.
Step 6이 완료되면 Taskmaster post_updates/문서 변경 사항을 Step 7에서 갱신하도록 알린다.
'''

[profiles.review.params]
temperature       = 0.1    # 리뷰/디퓨즈(엄격)
top_p             = 0.85
max_output_tokens = 1800
seed              = 42

# 브레인스토밍(이름/문구 아이디어) 프로필
[profiles.brainstorm]
stop_sequences = []
allow_code = true
system_prompt = '''
"브레인스토밍 단계"다. 아이디어/이름/문구/대안 설계 방안을 다양하게 제시하되,
문서 용어를 우선 사용하고, 최종 채택 전에는 코드를 생성하지 않는다. 채택 후 design→stubs 루프로 이동한다.
''' 

[profiles.brainstorm.params]
temperature       = 0.7    # 다양성 확보
top_p             = 1.0
max_output_tokens = 1800
# seed는 의도적으로 생략(비결정적 탐색)

# MCP Servers

[mcp.servers.fs_project]
type = "filesystem"
root = "/Users/gimseunghyeon/Desktop/school/졸업프로젝트(세탁)/pj_DormMate"
mode = "rw"
ignore = [".git", "node_modules", "build", "dist", ".gradle", ".next", "client/.next"]

# 문서(서비스 규격) RO 보호
[mcp.servers.fs_docs_service]
type = "filesystem"
root = "/Users/gimseunghyeon/Desktop/school/졸업프로젝트(세탁)/pj_DormMate/docs/service"
mode = "ro"

# 작업용 문서 RW: OpenAPI/Tasks만 포함
[mcp.servers.fs_docs_rw]
type = "filesystem"
root = "/Users/gimseunghyeon/Desktop/school/졸업프로젝트(세탁)/pj_DormMate/docs"
mode = "rw"
include = ["openapi/**", "tasks/**"]

[mcp.servers.proc]
type = "process"
allowed = [
  "bash -lc 'cd \"/Users/gimseunghyeon/Desktop/school/졸업프로젝트(세탁)/pj_DormMate\" && npx @stoplight/spectral lint docs/openapi/fridge-mvp.yaml'",
  "bash -lc 'cd \"/Users/gimseunghyeon/Desktop/school/졸업프로젝트(세탁)/pj_DormMate\" && npx @stoplight/prism mock docs/openapi/fridge-mvp.yaml'",
  "bash -lc 'cd \"/Users/gimseunghyeon/Desktop/school/졸업프로젝트(세탁)/pj_DormMate\" && ./gradlew clean test'",
  "bash -lc 'cd \"/Users/gimseunghyeon/Desktop/school/졸업프로젝트(세탁)/pj_DormMate\" && ./gradlew bootRun'",
  "bash -lc 'cd \"/Users/gimseunghyeon/Desktop/school/졸업프로젝트(세탁)/pj_DormMate\" && ./gradlew flywayMigrate'",
  "bash -lc 'cd \"/Users/gimseunghyeon/Desktop/school/졸업프로젝트(세탁)/pj_DormMate/client\" && npm install'",
  "bash -lc 'cd \"/Users/gimseunghyeon/Desktop/school/졸업프로젝트(세탁)/pj_DormMate/client\" && npm test'",
  "bash -lc 'cd \"/Users/gimseunghyeon/Desktop/school/졸업프로젝트(세탁)/pj_DormMate/client\" && npx playwright install'",
  "bash -lc 'cd \"/Users/gimseunghyeon/Desktop/school/졸업프로젝트(세탁)/pj_DormMate/client\" && npx playwright test'",
  "bash -lc 'cd \"/Users/gimseunghyeon/Desktop/school/졸업프로젝트(세탁)/pj_DormMate\" && docker compose up -d'",
  "bash -lc 'cd \"/Users/gimseunghyeon/Desktop/school/졸업프로젝트(세탁)/pj_DormMate\" && docker compose down'",
  "bash -lc 'cd \"/Users/gimseunghyeon/Desktop/school/졸업프로젝트(세탁)/pj_DormMate\" && docker compose ps'",
  "bash -lc 'cd \"/Users/gimseunghyeon/Desktop/school/졸업프로젝트(세탁)/pj_DormMate\" && docker compose logs --no-color --tail=200'"
]

[mcp.servers.git_local]
type = "git"
repo = "/Users/gimseunghyeon/Desktop/school/졸업프로젝트(세탁)/pj_DormMate"
auto_stage = false

# 주의: 현재 compose에 포트 매핑이 없어 호스트에서 'db' 접속이 어려울 수 있음.
# 필요 시 docker-compose에 ports 매핑 추가 후 DSN을 조정하세요.
[mcp.servers.pg_ro]
type = "postgres"
dsn  = "postgres://dorm_user:dorm_password@localhost:5432/dormitory_db?sslmode=disable"
read_only = true

[commands]
lint_openapi   = "bash -lc 'cd \"/Users/gimseunghyeon/Desktop/school/졸업프로젝트(세탁)/pj_DormMate\" && npx @stoplight/spectral lint docs/openapi/fridge-mvp.yaml'"
mock_api       = "bash -lc 'cd \"/Users/gimseunghyeon/Desktop/school/졸업프로젝트(세탁)/pj_DormMate\" && npx @stoplight/prism mock docs/openapi/fridge-mvp.yaml'"
test_backend   = "bash -lc 'cd \"/Users/gimseunghyeon/Desktop/school/졸업프로젝트(세탁)/pj_DormMate\" && ./gradlew clean test'"
run_backend    = "bash -lc 'cd \"/Users/gimseunghyeon/Desktop/school/졸업프로젝트(세탁)/pj_DormMate\" && ./gradlew bootRun'"
migrate_db     = "bash -lc 'cd \"/Users/gimseunghyeon/Desktop/school/졸업프로젝트(세탁)/pj_DormMate\" && ./gradlew flywayMigrate'"
test_frontend  = "bash -lc 'cd \"/Users/gimseunghyeon/Desktop/school/졸업프로젝트(세탁)/pj_DormMate/client\" && npm test'"
test_e2e       = "bash -lc 'cd \"/Users/gimseunghyeon/Desktop/school/졸업프로젝트(세탁)/pj_DormMate/client\" && npx playwright test'"
compose_up     = "bash -lc 'cd \"/Users/gimseunghyeon/Desktop/school/졸업프로젝트(세탁)/pj_DormMate\" && docker compose up -d'"
compose_down   = "bash -lc 'cd \"/Users/gimseunghyeon/Desktop/school/졸업프로젝트(세탁)/pj_DormMate\" && docker compose down'"

[policy]
jwt_days = 7
sse_fallback_seconds = 5
transaction_notes = "검사 세션/제출은 단일 트랜잭션 보장"
rbac_paths = ["/api/admin/**","/api/inspector/**","/api/fridge/**"]
